{"version":3,"file":"ltiform.min.js","sources":["../src/ltiform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * AMD module for the lti form in assignsubmission_ltisubmissions page.\r\n *\r\n * @module     assignsubmission_ltisubmissions/ltiform\r\n * @copyright  2023 Moodle India\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport $ from 'jquery';\r\nimport {get_string as getString} from 'core/str';\r\nexport const init = (hideoptions) => {\r\n    // var skipClientValidation = false;\r\n    $(document).on('click', '#id_assignsubmission_ltisubmissions_enabled', function(){\r\n        var ltisubmissionname = $(this).attr('name');\r\n        if($(this).is(':checked')){\r\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function(){\r\n                var elementname = $(this).attr('name');\r\n                if(ltisubmissionname != elementname &&\r\n                elementname.startsWith('assignsubmission_') && elementname.endsWith('_enabled')){\r\n                    if($(this).is(':checked')){\r\n                        $(this).trigger('click');\r\n                    }\r\n                    $(this).attr('disabled', true);\r\n                }\r\n            });\r\n        }else{\r\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function(){\r\n                var elementname = $(this).attr('name');\r\n                if(ltisubmissionname != elementname && elementname.startsWith('assignsubmission_')\r\n                && elementname.endsWith('_enabled')){\r\n                    $(this).attr('disabled', false);\r\n                }\r\n            });\r\n        }\r\n    });\r\n    $(document).ready(function(){\r\n        if($('#id_assignsubmission_ltisubmissions_enabled').is(':checked')){\r\n            if(hideoptions){// cannot edit if the activity is once defined as of type ltisubmission\r\n                $('#fgroup_id_submissionplugins').hide();\r\n            }\r\n            var ltisubmissionname = $('#id_assignsubmission_ltisubmissions_enabled').attr('name');\r\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function(){\r\n                var elementname = $(this).attr('name');\r\n                if(ltisubmissionname != elementname && elementname.startsWith('assignsubmission_')\r\n                && elementname.endsWith('_enabled')){\r\n                    if($(this).is(':checked')){\r\n                        $(this).trigger('click');\r\n                    }\r\n                    $(this).attr('disabled', true);\r\n                }\r\n            });\r\n        }\r\n    });\r\n    $(document).find(\"form[action='modedit.php']\").on( \"submit\", function(e) {\r\n        if($(e.originalEvent.submitter).data('skipValidation') == 1){\r\n            return true;\r\n        }\r\n        var formData = $(this).serializeArray();\r\n        var data = [];\r\n        $.each(formData, function(index, field){\r\n            data[field.name] = field.value;\r\n        });\r\n        if (data.assignsubmission_ltisubmissions_enabled == 1) {\r\n            var scrollindex = '';\r\n            var expandheader = false;\r\n            if(typeof(data.maxattempts) != undefined && data.maxattempts != -1) {\r\n                $('#id_maxattempts').addClass('is-invalid');\r\n                getString('maxattemptserror', 'assignsubmission_ltisubmissions').then(function (error) {\r\n                    $('#id_error_maxattempts').html(error);\r\n                }.bind(this));\r\n                scrollindex = 'id_maxattempts';\r\n                expandheader = true;\r\n            } else if ($('#id_maxattempts').hasClass('is-invalid')) {\r\n                $('#id_maxattempts').removeClass('is-invalid');\r\n                $('#id_error_maxattempts').html('');\r\n            }\r\n            if(typeof(data.attemptreopenmethod) != undefined && data.attemptreopenmethod != 'untilpass') {\r\n                $('#id_attemptreopenmethod').addClass('is-invalid');\r\n                getString('attemptreopenmethoderror', 'assignsubmission_ltisubmissions').then(function (error) {\r\n                    $('#id_error_attemptreopenmethod').html(error);\r\n                }.bind(this));\r\n                scrollindex = 'id_attemptreopenmethod';\r\n                expandheader = true;\r\n            } else if ($('#id_attemptreopenmethod').hasClass('is-invalid')) {\r\n                $('#id_attemptreopenmethod').removeClass('is-invalid');\r\n                $('#id_error_attemptreopenmethod').html('');\r\n            }\r\n            if(typeof(data.requiresubmissionstatement) != undefined && data.requiresubmissionstatement != 0) {\r\n                $('#id_requiresubmissionstatement').addClass('is-invalid');\r\n                getString('requiresubmissionstatementerror', 'assignsubmission_ltisubmissions').then(function (error) {\r\n                    $('#id_error_requiresubmissionstatement').html(error);\r\n                }.bind(this));\r\n                scrollindex = 'id_requiresubmissionstatement';\r\n                expandheader = true;\r\n            } else if ($('#id_requiresubmissionstatement').hasClass('is-invalid')) {\r\n                $('#id_requiresubmissionstatement').removeClass('is-invalid');\r\n                $('#id_error_requiresubmissionstatement').html('');\r\n            }\r\n            if(typeof(data.submissiondrafts) != undefined && data.submissiondrafts != 0) {\r\n                $('#id_submissiondrafts').addClass('is-invalid');\r\n                getString('submissiondraftserror', 'assignsubmission_ltisubmissions').then(function (error) {\r\n                    $('#id_error_submissiondrafts').html(error);\r\n                }.bind(this));\r\n                scrollindex = 'id_submissiondrafts';\r\n                expandheader = true;\r\n            } else if ($('#id_submissiondrafts').hasClass('is-invalid')) {\r\n                $('#id_submissiondrafts').removeClass('is-invalid');\r\n                $('#id_error_submissiondrafts').html('');\r\n            }\r\n            if(data.typeid == 0){\r\n                $('#id_typeid').addClass('is-invalid');\r\n                getString('invalidtypeid', 'assignsubmission_ltisubmissions').then(function (error) {\r\n                    $('#id_error_typeid').html(error);\r\n                }.bind(this));\r\n                scrollindex = 'id_typeid';\r\n            } else if ($('#id_typeid').hasClass('is-invalid')) {\r\n                $('#id_typeid').removeClass('is-invalid');\r\n                $('#id_error_typeid').html('');\r\n            }\r\n            if(scrollindex != ''){\r\n                if (expandheader && $('#id_submissionsettings [data-toggle=\"collapse\"]').attr('aria-expanded') == 'false') {\r\n                    $('#id_submissionsettings [data-toggle=\"collapse\"]').trigger('click');\r\n                }\r\n                document.getElementById(scrollindex).scrollIntoView();\r\n                return false;\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n    });\r\n};"],"names":["hideoptions","document","on","ltisubmissionname","this","attr","is","find","each","elementname","startsWith","endsWith","trigger","ready","hide","e","originalEvent","submitter","data","formData","serializeArray","index","field","name","value","assignsubmission_ltisubmissions_enabled","scrollindex","expandheader","undefined","maxattempts","addClass","then","error","html","bind","hasClass","removeClass","attemptreopenmethod","requiresubmissionstatement","submissiondrafts","typeid","getElementById","scrollIntoView"],"mappings":"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"}