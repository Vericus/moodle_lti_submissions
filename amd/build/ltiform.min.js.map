{"version":3,"file":"ltiform.min.js","sources":["../src/ltiform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for the lti form in assignsubmission_ltisubmissions page.\n *\n * @module     assignsubmission_ltisubmissions/ltiform\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nexport const init = (hideoptions) => {\n    // var skipClientValidation = false;\n    $(document).on('click', '#id_assignsubmission_ltisubmissions_enabled', function () {\n        var ltisubmissionname = $(this).attr('name');\n        if ($(this).is(':checked')) {\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function () {\n                var elementname = $(this).attr('name');\n                if (ltisubmissionname != elementname &&\n                    elementname.startsWith('assignsubmission_') && elementname.endsWith('_enabled')) {\n                    if ($(this).is(':checked')) {\n                        $(this).trigger('click');\n                    }\n                    $(this).attr('disabled', true);\n                }\n            });\n        } else {\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function () {\n                var elementname = $(this).attr('name');\n                if (ltisubmissionname != elementname && elementname.startsWith('assignsubmission_')\n                    && elementname.endsWith('_enabled')) {\n                    $(this).attr('disabled', false);\n                }\n            });\n        }\n    });\n    $(document).ready(function () {\n        if ($('#id_assignsubmission_ltisubmissions_enabled').is(':checked')) {\n            if (hideoptions) {// cannot edit if the activity is once defined as of type ltisubmission\n                $('#fgroup_id_submissionplugins').hide();\n            }\n            var ltisubmissionname = $('#id_assignsubmission_ltisubmissions_enabled').attr('name');\n            $('#fgroup_id_submissionplugins').find(':checkbox').each(function () {\n                var elementname = $(this).attr('name');\n                if (ltisubmissionname != elementname && elementname.startsWith('assignsubmission_')\n                    && elementname.endsWith('_enabled')) {\n                    if ($(this).is(':checked')) {\n                        $(this).trigger('click');\n                    }\n                    $(this).attr('disabled', true);\n                }\n            });\n        }\n    });\n    $(document).find(\"form[action='modedit.php']\").on(\"submit\", function (e) {\n        if ($(e.originalEvent.submitter).data('skipValidation') == 1) {\n            return true;\n        }\n        var formData = $(this).serializeArray();\n        var data = [];\n        $.each(formData, function (index, field) {\n            data[field.name] = field.value;\n        });\n        if (data.assignsubmission_ltisubmissions_enabled == 1) {\n            var scrollindex = '';\n            var expandheader = false;\n            if (typeof (data.maxattempts) !== 'undefined' && data.maxattempts != -1) {\n                $('#id_maxattempts').addClass('is-invalid');\n                getString('maxattemptserror', 'assignsubmission_ltisubmissions').then(function (error) {\n                    $('#id_error_maxattempts').html(error);\n                }.bind(this));\n                scrollindex = 'id_maxattempts';\n                expandheader = true;\n            } else if ($('#id_maxattempts').hasClass('is-invalid')) {\n                $('#id_maxattempts').removeClass('is-invalid');\n                $('#id_error_maxattempts').html('');\n            }\n            if (typeof (data.attemptreopenmethod) !== 'undefined' &&\n            ['automatic', 'untilpass'].indexOf(data.attemptreopenmethod) === -1) {\n                $('#id_attemptreopenmethod').addClass('is-invalid');\n                getString('attemptreopenmethoderror', 'assignsubmission_ltisubmissions').then(function (error) {\n                    $('#id_error_attemptreopenmethod').html(error);\n                }.bind(this));\n                scrollindex = 'id_attemptreopenmethod';\n                expandheader = true;\n            } else if ($('#id_attemptreopenmethod').hasClass('is-invalid')) {\n                $('#id_attemptreopenmethod').removeClass('is-invalid');\n                $('#id_error_attemptreopenmethod').html('');\n            }\n            if (typeof (data.requiresubmissionstatement) !== 'undefined' && data.requiresubmissionstatement != 0) {\n                $('#id_requiresubmissionstatement').addClass('is-invalid');\n                getString('requiresubmissionstatementerror', 'assignsubmission_ltisubmissions').then(function (error) {\n                    $('#id_error_requiresubmissionstatement').html(error);\n                }.bind(this));\n                scrollindex = 'id_requiresubmissionstatement';\n                expandheader = true;\n            } else if ($('#id_requiresubmissionstatement').hasClass('is-invalid')) {\n                $('#id_requiresubmissionstatement').removeClass('is-invalid');\n                $('#id_error_requiresubmissionstatement').html('');\n            }\n            if (typeof (data.submissiondrafts) !== 'undefined' && data.submissiondrafts != 0) {\n                $('#id_submissiondrafts').addClass('is-invalid');\n                getString('submissiondraftserror', 'assignsubmission_ltisubmissions').then(function (error) {\n                    $('#id_error_submissiondrafts').html(error);\n                }.bind(this));\n                scrollindex = 'id_submissiondrafts';\n                expandheader = true;\n            } else if ($('#id_submissiondrafts').hasClass('is-invalid')) {\n                $('#id_submissiondrafts').removeClass('is-invalid');\n                $('#id_error_submissiondrafts').html('');\n            }\n            if (data.typeid == 0) {\n                $('#id_typeid').addClass('is-invalid');\n                getString('invalidtypeid', 'assignsubmission_ltisubmissions').then(function (error) {\n                    $('#id_error_typeid').html(error);\n                }.bind(this));\n                scrollindex = 'id_typeid';\n            } else if ($('#id_typeid').hasClass('is-invalid')) {\n                $('#id_typeid').removeClass('is-invalid');\n                $('#id_error_typeid').html('');\n            }\n            if (scrollindex != '') {\n                if (expandheader && $('#id_submissionsettings [data-toggle=\"collapse\"]').attr('aria-expanded') == 'false') {\n                    $('#id_submissionsettings [data-toggle=\"collapse\"]').trigger('click');\n                }\n                document.getElementById(scrollindex).scrollIntoView();\n                return false;\n            } else {\n                return true;\n            }\n        }\n    });\n};\n"],"names":["hideoptions","document","on","ltisubmissionname","this","attr","is","find","each","elementname","startsWith","endsWith","trigger","ready","hide","e","originalEvent","submitter","data","formData","serializeArray","index","field","name","value","assignsubmission_ltisubmissions_enabled","scrollindex","expandheader","maxattempts","addClass","then","error","html","bind","hasClass","removeClass","attemptreopenmethod","indexOf","requiresubmissionstatement","submissiondrafts","typeid","getElementById","scrollIntoView"],"mappings":"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"}